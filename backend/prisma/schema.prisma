generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  AGENT
  CUSTOMER
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      Role     @default(CUSTOMER)
  invited   Boolean  @default(false)
  tickets   Ticket[]
  comments  Comment[]
  messages  Message[]
  filesUploaded File[] @relation("UserFilesUploaded")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  emailNotificationsEnabled Boolean @default(true) // 메일 수신 여부
  extraEmails String[] // 추가 이메일
}

model Ticket {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  status    String   @default("open")
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  comments  Comment[]
  messages  Message[]
  files     File[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  cc        String[] // CC 이메일 리스트
  companyName String? // 고객사명
}

model Comment {
  id        Int      @id @default(autoincrement())
  content   String
  ticket    Ticket   @relation(fields: [ticketId], references: [id])
  ticketId  Int
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  createdAt DateTime @default(now())
}

model Message {
  id        Int      @id @default(autoincrement())
  content   String
  ticket    Ticket   @relation(fields: [ticketId], references: [id])
  ticketId  Int
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  createdAt DateTime @default(now())
  files     File[]   @relation("MessageFiles")
}

model File {
  id        Int      @id @default(autoincrement())
  url       String
  filename  String
  ticket    Ticket?  @relation(fields: [ticketId], references: [id])
  ticketId  Int?
  uploadedBy User?   @relation("UserFilesUploaded", fields: [uploadedById], references: [id])
  uploadedById Int?
  message     Message? @relation("MessageFiles", fields: [messageId], references: [id])
  messageId   Int?
  createdAt DateTime @default(now())
  size        Int?
}

model InviteEmailTemplate {
  id        Int      @id @default(autoincrement())
  type      String   // 예: 'invite'
  subject   String
  body      String   // HTML
  updatedAt DateTime @updatedAt
}

model Invite {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  role       Role
  invitedAt  DateTime @default(now())
  accepted   Boolean  @default(false)
  acceptedAt DateTime?
} 