(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[824],{1445:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tickets",function(){return s(6505)}])},5402:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var n=s(5893),r=s(7294),a=s(7642),l=s(9090),i=s(3454),o=s(1876).Buffer;let c=null;function d(e){let{ticketId:t,userName:s}=e,[d,x]=(0,r.useState)([]),[u,m]=(0,r.useState)(""),[h,p]=(0,r.useState)(null),[f,g]=(0,r.useState)(!1),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{l.Z.get("/tickets/".concat(t,"/messages")).then(e=>{x(e.data.messages||[])})},[t]),(0,r.useEffect)(()=>((c=(0,a.io)(i.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:4000",{transports:["websocket"]})).on("connect",()=>g(!0)),c.on("disconnect",()=>g(!1)),c.emit("join",{ticketId:t,userName:s}),c.on("chat",e=>{x(t=>[...t,e])}),c.on("history",e=>{x(e)}),()=>{null==c||c.disconnect()}),[t,s]),(0,r.useEffect)(()=>{var e;null===(e=b.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[d]);let y=async e=>{let n,r;if(e.preventDefault(),!u&&!h)return;if(h){let e=await h.arrayBuffer(),t=o.from(e).toString("base64");r={name:h.name,data:t,mimetype:h.type},n={name:h.name,url:"#"}}let a={id:Math.random().toString(),user:s,content:u,createdAt:new Date().toLocaleString(),file:n};x(e=>[...e,a]),null==c||c.emit("chat",{ticketId:t,user:s,content:u,createdAt:new Date().toISOString(),file:r}),m(""),p(null)};return(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 max-w-lg mx-auto border border-gray-100",children:[(0,n.jsxs)("div",{className:"font-bold mb-4 text-lg flex items-center gap-2",children:["실시간 채팅",f?(0,n.jsx)("span",{className:"text-green-500 text-base",children:"●"}):(0,n.jsx)("span",{className:"text-gray-400 text-base",children:"●"})]}),(0,n.jsxs)("div",{className:"h-64 overflow-y-auto border rounded-lg p-3 mb-4 bg-gray-50 space-y-3",children:[d.map(e=>(0,n.jsx)("div",{className:"flex flex-col ".concat(e.user===s?"items-end":"items-start"),children:(0,n.jsxs)("div",{className:"max-w-[80%] px-4 py-2 rounded-2xl shadow-sm ".concat(e.user===s?"bg-blue-100 text-blue-900":"bg-gray-200 text-gray-800"),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,n.jsx)("span",{className:"font-semibold text-sm",children:e.user}),(0,n.jsx)("span",{className:"text-xs text-gray-500",children:e.createdAt})]}),(0,n.jsx)("div",{className:"whitespace-pre-line break-words text-sm",children:e.content}),e.file&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("a",{href:e.file.url,className:"text-xs text-blue-600 underline",download:!0,children:decodeURIComponent(e.file.name)}),/\.(png|jpe?g|gif|bmp|webp)$/i.test(decodeURIComponent(e.file.name))&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)("img",{src:e.file.url,alt:decodeURIComponent(e.file.name),className:"max-w-[200px] rounded-lg border"})})]})]})},e.id)),(0,n.jsx)("div",{ref:b})]}),(0,n.jsxs)("form",{onSubmit:y,className:"flex flex-col sm:flex-row gap-2 items-stretch",children:[(0,n.jsx)("input",{type:"text",className:"flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200 text-base",placeholder:"메시지 입력",value:u,onChange:e=>m(e.target.value)}),(0,n.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer bg-gray-100 px-3 py-2 rounded-lg border border-gray-200 hover:bg-gray-200 transition text-sm",children:["파일 선택",(0,n.jsx)("input",{type:"file",onChange:e=>{var t;return p((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"hidden"})]}),(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition font-semibold disabled:opacity-50",disabled:!u&&!h,children:"전송"})]}),h&&(0,n.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["선택된 파일: ",h.name]})]})}},4820:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var n=s(5893),r=s(7294),a=s(1664),l=s.n(a),i=s(1163),o=s(4231);function c(e){let{children:t}=e,s=(0,i.useRouter)(),{token:a,logout:c,user:d,fetchUser:x}=(0,o.a)();return r.useEffect(()=>{a&&!d&&x()},[a,d,x]),(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,n.jsxs)("nav",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur shadow-md px-8 py-4 flex items-center justify-between border-b",children:[(0,n.jsx)(l(),{href:"/",children:(0,n.jsx)("span",{className:"font-extrabold text-2xl text-blue-700 tracking-tight cursor-pointer select-none",children:"Ticket System"})}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{href:"/tickets",children:(0,n.jsx)("span",{className:"hover:underline cursor-pointer text-blue-700 font-semibold px-3 py-1 rounded transition",children:"티켓 목록"})}),(0,n.jsx)(l(),{href:"/mypage",children:(0,n.jsx)("span",{className:"hover:underline cursor-pointer text-gray-700 font-semibold px-3 py-1 rounded transition",children:"내 정보"})}),(null==d?void 0:d.role)==="ADMIN"&&(0,n.jsx)(l(),{href:"/admin",children:(0,n.jsx)("span",{className:"hover:underline cursor-pointer text-red-700 font-semibold px-3 py-1 rounded transition",children:"관리자"})}),(0,n.jsx)("button",{onClick:()=>{c(),s.push("/login")},className:"bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 text-gray-700 font-semibold border border-gray-200 transition",children:"로그아웃"})]}):(0,n.jsx)(l(),{href:"/login",children:(0,n.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 cursor-pointer font-semibold transition",children:"로그인"})})})]}),(0,n.jsx)("main",{className:"max-w-3xl mx-auto py-12 px-4 md:px-0",children:t})]})}},6505:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var n=s(5893),r=s(7294),a=s(1163),l=s(4820),i=s(4231),o=s(9090),c=s(5402);function d(){let e=(0,a.useRouter)(),{token:t}=(0,i.a)(),[s,d]=(0,r.useState)([]),[x,u]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{if(!t){e.push("/login");return}o.Z.get("/tickets",{headers:{Authorization:"Bearer ".concat(t)}}).then(e=>{d(e.data.tickets),u(!1)}).catch(()=>u(!1))},[t,e]),(0,n.jsxs)(l.Z,{children:[(0,n.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4",children:[(0,n.jsx)("h1",{className:"text-3xl font-extrabold tracking-tight text-gray-900",children:"티켓 목록"}),(0,n.jsx)("button",{className:"inline-flex items-center gap-2 bg-blue-600 text-white px-5 py-2 rounded-lg shadow hover:bg-blue-700 transition font-semibold text-base",onClick:()=>e.push("/tickets/new"),children:"+ 새 티켓 생성"})]}),x?(0,n.jsx)("div",{className:"text-center text-gray-500 py-12",children:"로딩 중..."}):0===s.length?(0,n.jsx)("div",{className:"text-center text-gray-400 py-12",children:"티켓이 없습니다."}):(0,n.jsx)("div",{className:"overflow-x-auto rounded-xl shadow-lg bg-white",children:(0,n.jsxs)("table",{className:"w-full min-w-[600px]",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100 text-gray-700 text-sm",children:[(0,n.jsx)("th",{className:"py-3 px-4 text-left font-semibold",children:"번호"}),(0,n.jsx)("th",{className:"py-3 px-4 text-left font-semibold",children:"제목"}),(0,n.jsx)("th",{className:"py-3 px-4 text-left font-semibold",children:"상태"}),(0,n.jsx)("th",{className:"py-3 px-4 text-left font-semibold",children:"생성일"})]})}),(0,n.jsx)("tbody",{children:s.map(t=>(0,n.jsxs)("tr",{className:"hover:bg-blue-50 cursor-pointer border-b transition",onClick:()=>e.push("/tickets/".concat(t.id)),children:[(0,n.jsx)("td",{className:"py-3 px-4 font-mono text-xs text-gray-700",children:t.ticketNo}),(0,n.jsx)("td",{className:"py-3 px-4 text-base text-gray-900 font-medium",children:t.title}),(0,n.jsx)("td",{className:"py-3 px-4",children:(0,n.jsx)("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-bold ".concat("OPEN"===t.status?"bg-green-100 text-green-700":"bg-gray-200 text-gray-600"),children:t.status})}),(0,n.jsx)("td",{className:"py-3 px-4 text-sm text-gray-500",children:new Date(t.createdAt).toLocaleString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})]},t.id))})]})}),(0,n.jsx)("div",{className:"my-16",children:(0,n.jsx)(c.Z,{ticketId:"main",userName:"익명"})})]})}},4231:function(e,t,s){"use strict";s.d(t,{a:function(){return a}});var n=s(4529),r=s(9090);let a=(0,n.Ue)((e,t)=>({token:localStorage.getItem("token"),user:null,setToken:s=>{localStorage.setItem("token",s),e({token:s}),t().fetchUser()},setUser:t=>e({user:t}),fetchUser:async()=>{let s=t().token;if(!s)return e({user:null});try{let t=await r.Z.get("/users/me",{headers:{Authorization:"Bearer ".concat(s)}});e({user:t.data})}catch(t){e({user:null})}},logout:()=>{localStorage.removeItem("token"),e({token:null,user:null})}}))},9090:function(e,t,s){"use strict";var n=s(7066),r=s(3454);let a=n.Z.create({baseURL:r.env.NEXT_PUBLIC_API_URL||"http://localhost:4000"});t.Z=a}},function(e){e.O(0,[66,927,642,888,774,179],function(){return e(e.s=1445)}),_N_E=e.O()}]);