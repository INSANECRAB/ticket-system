(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{6603:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tickets/new",function(){return n(4006)}])},4820:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(5893),s=n(7294),a=n(1664),l=n.n(a),o=n(1163),i=n(4231);function u(e){let{children:t}=e,n=(0,o.useRouter)(),{token:a,logout:u,user:c,fetchUser:d}=(0,i.a)();return s.useEffect(()=>{a&&!c&&d()},[a,c,d]),(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,r.jsxs)("nav",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur shadow-md px-8 py-4 flex items-center justify-between border-b",children:[(0,r.jsx)(l(),{href:"/",children:(0,r.jsx)("span",{className:"font-extrabold text-2xl text-blue-700 tracking-tight cursor-pointer select-none",children:"Ticket System"})}),(0,r.jsx)("div",{className:"flex items-center gap-4",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l(),{href:"/tickets",children:(0,r.jsx)("span",{className:"hover:underline cursor-pointer text-blue-700 font-semibold px-3 py-1 rounded transition",children:"티켓 목록"})}),(0,r.jsx)(l(),{href:"/mypage",children:(0,r.jsx)("span",{className:"hover:underline cursor-pointer text-gray-700 font-semibold px-3 py-1 rounded transition",children:"내 정보"})}),(null==c?void 0:c.role)==="ADMIN"&&(0,r.jsx)(l(),{href:"/admin",children:(0,r.jsx)("span",{className:"hover:underline cursor-pointer text-red-700 font-semibold px-3 py-1 rounded transition",children:"관리자"})}),(0,r.jsx)("button",{onClick:()=>{u(),n.push("/login")},className:"bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 text-gray-700 font-semibold border border-gray-200 transition",children:"로그아웃"})]}):(0,r.jsx)(l(),{href:"/login",children:(0,r.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 cursor-pointer font-semibold transition",children:"로그인"})})})]}),(0,r.jsx)("main",{className:"max-w-3xl mx-auto py-12 px-4 md:px-0",children:t})]})}},4006:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var r=n(5893),s=n(7294),a=n(1163),l=n(4820),o=n(4231),i=n(9090);function u(){let e=(0,a.useRouter)(),{token:t}=(0,o.a)(),[n,u]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[p,x]=(0,s.useState)(null),[h,m]=(0,s.useState)(""),[b,f]=(0,s.useState)(!1),[g,y]=(0,s.useState)(""),[v,j]=(0,s.useState)([]),[N,w]=(0,s.useState)("");if(!t)return e.push("/login"),null;let k=()=>{let e=g.trim();e&&!v.includes(e)&&(j([...v,e]),y(""))},_=e=>{j(v.filter(t=>t!==e))},S=async r=>{r.preventDefault(),m(""),f(!0);try{let r=new FormData;r.append("title",n),r.append("content",c),r.append("cc",JSON.stringify(v)),r.append("companyName",N),p&&r.append("file",p),await i.Z.post("/tickets",r,{headers:{Authorization:"Bearer ".concat(t)}}),e.push("/tickets")}catch(e){var s,a;m((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"생성 실패")}finally{f(!1)}};return(0,r.jsx)(l.Z,{children:(0,r.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"새 티켓 생성"}),(0,r.jsxs)("form",{onSubmit:S,className:"bg-white p-6 rounded shadow space-y-4",children:[(0,r.jsx)("input",{type:"text",placeholder:"제목",className:"w-full px-3 py-2 border rounded",value:n,onChange:e=>u(e.target.value),required:!0}),(0,r.jsx)("textarea",{placeholder:"내용",className:"w-full px-3 py-2 border rounded min-h-[100px]",value:c,onChange:e=>d(e.target.value),required:!0}),(0,r.jsx)("input",{type:"text",placeholder:"고객사명 (선택)",className:"w-full px-3 py-2 border rounded",value:N,onChange:e=>w(e.target.value)}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,r.jsx)("input",{type:"email",placeholder:"CC 이메일 추가",className:"flex-1 px-3 py-2 border rounded",value:g,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),k())}}),(0,r.jsx)("button",{type:"button",onClick:k,className:"bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700",children:"추가"})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:v.map(e=>(0,r.jsxs)("span",{className:"bg-gray-200 px-2 py-1 rounded text-sm flex items-center gap-1",children:[e,(0,r.jsx)("button",{type:"button",onClick:()=>_(e),className:"ml-1 text-red-500 hover:underline",children:"\xd7"})]},e))})]}),(0,r.jsx)("input",{type:"file",className:"mb-3",onChange:e=>{var t;return x((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}}),h&&(0,r.jsx)("div",{className:"text-red-500 text-sm mb-2",children:h}),(0,r.jsx)("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:opacity-50",disabled:b,children:b?"생성 중...":"티켓 생성"})]})]})})}},4231:function(e,t,n){"use strict";n.d(t,{a:function(){return a}});var r=n(4529),s=n(9090);let a=(0,r.Ue)((e,t)=>({token:localStorage.getItem("token"),user:null,setToken:n=>{localStorage.setItem("token",n),e({token:n}),t().fetchUser()},setUser:t=>e({user:t}),fetchUser:async()=>{let n=t().token;if(!n)return e({user:null});try{let t=await s.Z.get("/users/me",{headers:{Authorization:"Bearer ".concat(n)}});e({user:t.data})}catch(t){e({user:null})}},logout:()=>{localStorage.removeItem("token"),e({token:null,user:null})}}))},9090:function(e,t,n){"use strict";var r=n(7066),s=n(3454);let a=r.Z.create({baseURL:s.env.NEXT_PUBLIC_API_URL||"http://localhost:4000"});t.Z=a}},function(e){e.O(0,[66,927,888,774,179],function(){return e(e.s=6603)}),_N_E=e.O()}]);