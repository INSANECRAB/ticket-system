(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[217],{1642:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tickets/[id]",function(){return n(3353)}])},4820:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var s=n(5893),a=n(7294),r=n(1664),l=n.n(r),i=n(1163),c=n(4231);function o(e){let{children:t}=e,n=(0,i.useRouter)(),{token:r,logout:o,user:d,fetchUser:u}=(0,c.a)();return a.useEffect(()=>{r&&!d&&u()},[r,d,u]),(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,s.jsxs)("nav",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur shadow-md px-8 py-4 flex items-center justify-between border-b",children:[(0,s.jsx)(l(),{href:"/",children:(0,s.jsx)("span",{className:"font-extrabold text-2xl text-blue-700 tracking-tight cursor-pointer select-none",children:"Ticket System"})}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l(),{href:"/tickets",children:(0,s.jsx)("span",{className:"hover:underline cursor-pointer text-blue-700 font-semibold px-3 py-1 rounded transition",children:"티켓 목록"})}),(0,s.jsx)(l(),{href:"/mypage",children:(0,s.jsx)("span",{className:"hover:underline cursor-pointer text-gray-700 font-semibold px-3 py-1 rounded transition",children:"내 정보"})}),(null==d?void 0:d.role)==="ADMIN"&&(0,s.jsx)(l(),{href:"/admin",children:(0,s.jsx)("span",{className:"hover:underline cursor-pointer text-red-700 font-semibold px-3 py-1 rounded transition",children:"관리자"})}),(0,s.jsx)("button",{onClick:()=>{o(),n.push("/login")},className:"bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 text-gray-700 font-semibold border border-gray-200 transition",children:"로그아웃"})]}):(0,s.jsx)(l(),{href:"/login",children:(0,s.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 cursor-pointer font-semibold transition",children:"로그인"})})})]}),(0,s.jsx)("main",{className:"max-w-3xl mx-auto py-12 px-4 md:px-0",children:t})]})}},3353:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var s=n(5893),a=n(7294),r=n(1163),l=n(4820),i=n(4231),c=n(9090);function o(){let e=(0,r.useRouter)(),{id:t}=e.query,{token:n}=(0,i.a)(),[o,d]=(0,a.useState)(null),[u,h]=(0,a.useState)([]),[x,m]=(0,a.useState)(""),[p,b]=(0,a.useState)(null),[f,g]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(!n){e.push("/login");return}t&&(g(!0),c.Z.get("/tickets/".concat(t),{headers:{Authorization:"Bearer ".concat(n)}}).then(e=>{let t=e.data.ticket;d({id:t.id,ticketNo:"TKT-".concat(new Date(t.createdAt).getFullYear()).concat(String(new Date(t.createdAt).getMonth()+1).padStart(2,"0")).concat(String(new Date(t.createdAt).getDate()).padStart(2,"0"),"-").concat(String(t.id).padStart(4,"0")),title:t.title,content:t.content,status:t.status,createdAt:t.createdAt,files:(t.files||[]).map(e=>({id:e.id,name:e.filename,url:e.url}))}),g(!1)}).catch(()=>g(!1)),c.Z.get("/comments/ticket/".concat(t),{headers:{Authorization:"Bearer ".concat(n)}}).then(e=>h(e.data.comments||[])))},[n,t,e]);let j=async e=>{if(e.preventDefault(),!x)return;let s=await c.Z.post("/comments",{ticketId:t,content:x},{headers:{Authorization:"Bearer ".concat(n)}});h(e=>[...e,s.data.comment]),m(""),b(null)},N=async e=>{await c.Z.delete("/comments/".concat(e),{headers:{Authorization:"Bearer ".concat(n)}}),h(t=>t.filter(t=>t.id!==e))},y=async()=>{window.confirm("정말 삭제하시겠습니까?")&&(await c.Z.delete("/tickets/".concat(t),{headers:{Authorization:"Bearer ".concat(n)}}),e.push("/tickets"))},[v,w]=(0,a.useState)(!1),[k,S]=(0,a.useState)(""),[A,_]=(0,a.useState)(""),C=async()=>{await c.Z.put("/tickets/".concat(t),{title:k,content:A},{headers:{Authorization:"Bearer ".concat(n)}}),d(e=>e?{...e,title:k,content:A}:e),w(!1)};return f?(0,s.jsx)(l.Z,{children:(0,s.jsx)("div",{children:"로딩 중..."})}):o?(0,s.jsxs)(l.Z,{children:[(0,s.jsxs)("div",{className:"mb-10 p-8 bg-white rounded shadow",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:o.title}),(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{onClick:()=>{w(!0),S(o.title),_(o.content)},className:"mr-2 text-xs text-blue-600 underline",children:"수정"}),(0,s.jsx)("button",{onClick:y,className:"text-xs text-red-600 underline",children:"삭제"})]})]}),(0,s.jsxs)("div",{className:"text-gray-500 mb-3",children:["티켓번호: ",o.ticketNo," | 상태: ",o.status," | 생성일: ",o.createdAt]}),(0,s.jsx)("div",{className:"mb-4 whitespace-pre-line text-lg",children:o.content}),v&&(0,s.jsxs)("div",{className:"mt-2 p-4 border rounded bg-gray-50",children:[(0,s.jsx)("input",{value:k,onChange:e=>S(e.target.value),placeholder:"제목",className:"block w-full mb-2 border px-3 py-2 rounded"}),(0,s.jsx)("textarea",{value:A,onChange:e=>_(e.target.value),placeholder:"내용",className:"block w-full mb-2 border px-3 py-2 rounded min-h-[80px]"}),(0,s.jsx)("button",{onClick:C,className:"bg-blue-600 text-white px-4 py-2 rounded mr-2",children:"저장"}),(0,s.jsx)("button",{onClick:()=>w(!1),className:"bg-gray-300 px-4 py-2 rounded",children:"취소"})]}),o.files.length>0&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("span",{className:"font-semibold",children:"첨부파일:"}),o.files.map(e=>{let t=decodeURIComponent(e.name),n=/\.(png|jpe?g|gif|bmp|webp)$/i.test(t);return(0,s.jsxs)("span",{className:"ml-2",children:[(0,s.jsx)("a",{href:e.url,className:"text-blue-600 underline",download:!0,children:t}),n&&(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)("img",{src:e.url,alt:t,style:{maxWidth:400}})})]},e.id)})]})]}),(0,s.jsxs)("div",{className:"mb-12 p-8 bg-white rounded shadow",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-4",children:"댓글"}),(0,s.jsxs)("form",{onSubmit:j,className:"flex flex-col gap-3 mb-6",children:[(0,s.jsx)("textarea",{placeholder:"댓글을 입력하세요",className:"w-full px-3 py-2 border rounded min-h-[60px]",value:x,onChange:e=>m(e.target.value),required:!0}),(0,s.jsx)("input",{type:"file",onChange:e=>{var t;return b((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"border rounded px-3 py-2"}),(0,s.jsx)("button",{type:"submit",className:"self-end bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",disabled:!x,children:"댓글 등록"})]}),(0,s.jsx)("div",{className:"space-y-4",children:u.map(e=>(0,s.jsxs)("div",{className:"bg-gray-100 rounded p-4 flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-semibold mb-1",children:[e.user.name," ",(0,s.jsx)("span",{className:"text-xs text-gray-500",children:e.createdAt})]}),(0,s.jsx)("div",{className:"mb-2 whitespace-pre-line",children:e.content})]}),(0,s.jsx)("button",{onClick:()=>N(e.id),className:"text-xs text-red-600 underline ml-4",children:"삭제"})]},e.id))})]})]}):(0,s.jsx)(l.Z,{children:(0,s.jsx)("div",{children:"티켓을 찾을 수 없습니다."})})}},4231:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var s=n(4529),a=n(9090);let r=(0,s.Ue)((e,t)=>({token:localStorage.getItem("token"),user:null,setToken:n=>{localStorage.setItem("token",n),e({token:n}),t().fetchUser()},setUser:t=>e({user:t}),fetchUser:async()=>{let n=t().token;if(!n)return e({user:null});try{let t=await a.Z.get("/users/me",{headers:{Authorization:"Bearer ".concat(n)}});e({user:t.data})}catch(t){e({user:null})}},logout:()=>{localStorage.removeItem("token"),e({token:null,user:null})}}))},9090:function(e,t,n){"use strict";var s=n(7066),a=n(3454);let r=s.Z.create({baseURL:a.env.NEXT_PUBLIC_API_URL||"http://localhost:4000"});t.Z=r}},function(e){e.O(0,[66,927,888,774,179],function(){return e(e.s=1642)}),_N_E=e.O()}]);