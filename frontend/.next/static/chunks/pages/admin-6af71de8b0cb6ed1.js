(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{577:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return s(4298)}])},4820:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var a=s(5893),r=s(7294),l=s(1664),n=s.n(l),i=s(1163),c=s(4231);function d(e){let{children:t}=e,s=(0,i.useRouter)(),{token:l,logout:d,user:o,fetchUser:u}=(0,c.a)();return r.useEffect(()=>{l&&!o&&u()},[l,o,u]),(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,a.jsxs)("nav",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur shadow-md px-8 py-4 flex items-center justify-between border-b",children:[(0,a.jsx)(n(),{href:"/",children:(0,a.jsx)("span",{className:"font-extrabold text-2xl text-blue-700 tracking-tight cursor-pointer select-none",children:"Ticket System"})}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n(),{href:"/tickets",children:(0,a.jsx)("span",{className:"hover:underline cursor-pointer text-blue-700 font-semibold px-3 py-1 rounded transition",children:"티켓 목록"})}),(0,a.jsx)(n(),{href:"/mypage",children:(0,a.jsx)("span",{className:"hover:underline cursor-pointer text-gray-700 font-semibold px-3 py-1 rounded transition",children:"내 정보"})}),(null==o?void 0:o.role)==="ADMIN"&&(0,a.jsx)(n(),{href:"/admin",children:(0,a.jsx)("span",{className:"hover:underline cursor-pointer text-red-700 font-semibold px-3 py-1 rounded transition",children:"관리자"})}),(0,a.jsx)("button",{onClick:()=>{d(),s.push("/login")},className:"bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 text-gray-700 font-semibold border border-gray-200 transition",children:"로그아웃"})]}):(0,a.jsx)(n(),{href:"/login",children:(0,a.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 cursor-pointer font-semibold transition",children:"로그인"})})})]}),(0,a.jsx)("main",{className:"max-w-3xl mx-auto py-12 px-4 md:px-0",children:t})]})}},4298:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(5893),r=s(7294),l=s(4820),n=s(9090),i=s(4231);function c(){let{token:e,user:t,fetchUser:s}=(0,i.a)(),[c,d]=(0,r.useState)([]),[o,u]=(0,r.useState)(!0),[x,h]=(0,r.useState)(""),[m,p]=(0,r.useState)("CUSTOMER"),[b,v]=(0,r.useState)(""),[j,N]=(0,r.useState)(""),[f,y]=(0,r.useState)(""),[g,w]=(0,r.useState)(""),[S,k]=(0,r.useState)(!1),[A,U]=(0,r.useState)(""),[C,E]=(0,r.useState)(""),[_,Z]=(0,r.useState)(null),[T,z]=(0,r.useState)([]),B=()=>{e&&(u(!0),Promise.all([n.Z.get("/users",{headers:{Authorization:"Bearer ".concat(e)}}),n.Z.get("/users/invites",{headers:{Authorization:"Bearer ".concat(e)}})]).then(e=>{let[t,s]=e;d(t.data.users),z(s.data.invites),u(!1)}).catch(()=>u(!1)))};if((0,r.useEffect)(()=>{e&&!t&&s(),e&&(B(),k(!0),n.Z.get("/email-template/invite",{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{y(e.data.subject),w(e.data.body),k(!1)}).catch(()=>k(!1)))},[e,t,s]),t&&"ADMIN"!==t.role)return(0,a.jsx)(l.Z,{children:(0,a.jsx)("div",{className:"max-w-xl mx-auto mt-16 text-center text-red-600 text-lg font-bold",children:"관리자만 접근할 수 있습니다."})});let M=async t=>{t.preventDefault(),v(""),N("");try{await n.Z.post("/auth/invite",{email:x,role:m},{headers:{Authorization:"Bearer ".concat(e)}}),N("초대 메일이 발송되었습니다."),h(""),p("CUSTOMER"),B()}catch(e){var s,a;v((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"초대 실패"),B()}},I=async()=>{U(""),E("");try{await n.Z.put("/email-template/invite",{subject:f,body:g},{headers:{Authorization:"Bearer ".concat(e)}}),E("저장되었습니다.")}catch(e){var t,s;U((null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"저장 실패")}},R=async t=>{if(window.confirm("정말 삭제하시겠습니까?")){Z(null);try{await n.Z.delete("/users/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}}),d(e=>e.filter(e=>e.id!==t)),Z({text:"유저가 삭제되었습니다.",color:"blue"})}catch(e){Z({text:"삭제 실패했습니다.",color:"red"})}}},O=async(t,s)=>{await n.Z.put("/users/".concat(t,"/role"),{role:s},{headers:{Authorization:"Bearer ".concat(e)}}),d(e=>e.map(e=>e.id===t?{...e,role:s}:e))},D=async t=>{if(window.confirm("정말 초대 내역을 삭제하시겠습니까?"))try{await n.Z.delete("/users/invites/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}}),B(),Z({text:"초대 내역이 삭제되었습니다.",color:"blue"})}catch(e){Z({text:"초대 내역 삭제 실패",color:"red"})}},P=Array.from(new Set([...c.map(e=>e.email),...T.filter(e=>!e.accepted).map(e=>e.email)])).map(e=>{let t=c.find(t=>t.email===e),s=T.find(t=>t.email===e&&!t.accepted);return{email:e,name:(null==t?void 0:t.name)||"-",role:(null==t?void 0:t.role)||(null==s?void 0:s.role)||"CUSTOMER",createdAt:(null==t?void 0:t.createdAt)||(null==s?void 0:s.invitedAt)||"",status:t?"등록완료":"초대메일 발송완료",id:(null==t?void 0:t.id)||(null==s?void 0:s.id),isUser:!!t}});return(0,a.jsx)(l.Z,{children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto bg-white rounded shadow p-8 mt-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"사용자 관리"}),_&&(0,a.jsx)("div",{className:"mb-4 text-".concat(_.color,"-600 font-semibold"),children:_.text}),(0,a.jsxs)("form",{onSubmit:M,className:"flex gap-2 mb-6 items-end",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"초대 이메일"}),(0,a.jsx)("input",{value:x,onChange:e=>h(e.target.value),className:"w-full border px-2 py-1 rounded",required:!0,type:"email"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"권한"}),(0,a.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:"border px-2 py-1 rounded",children:[(0,a.jsx)("option",{value:"CUSTOMER",children:"고객"}),(0,a.jsx)("option",{value:"AGENT",children:"상담원"}),(0,a.jsx)("option",{value:"ADMIN",children:"관리자"})]})]}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"초대"})]}),b&&(0,a.jsx)("div",{className:"text-red-600 mb-2",children:b}),j&&(0,a.jsx)("div",{className:"text-green-600 mb-2",children:j}),(0,a.jsxs)("div",{className:"my-8 p-4 bg-gray-50 rounded",children:[(0,a.jsx)("div",{className:"font-bold mb-2",children:"초대 메일 템플릿 관리"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mb-2",children:["사용 가능한 변수: ",(0,a.jsxs)("span",{className:"font-mono",children:["$","{inviteUrl}"]}),", ",(0,a.jsxs)("span",{className:"font-mono",children:["$","{email}"]})]}),(0,a.jsx)("input",{type:"text",className:"w-full border px-2 py-1 rounded mb-2",value:f,onChange:e=>y(e.target.value),placeholder:"메일 제목",disabled:S}),(0,a.jsx)("textarea",{className:"w-full border px-2 py-1 rounded mb-2 min-h-[100px]",value:g,onChange:e=>w(e.target.value),placeholder:"메일 본문 (HTML 가능)",disabled:S}),A&&(0,a.jsx)("div",{className:"text-red-600 mb-2",children:A}),C&&(0,a.jsx)("div",{className:"text-green-600 mb-2",children:C}),(0,a.jsx)("button",{type:"button",className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:I,disabled:S,children:"템플릿 저장"})]}),o?(0,a.jsx)("div",{children:"로딩 중..."}):(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"py-2 px-3",children:"이메일"}),(0,a.jsx)("th",{className:"py-2 px-3",children:"이름"}),(0,a.jsx)("th",{className:"py-2 px-3",children:"권한"}),(0,a.jsx)("th",{className:"py-2 px-3",children:"가입/초대일"}),(0,a.jsx)("th",{className:"py-2 px-3",children:"상태"}),(0,a.jsx)("th",{className:"py-2 px-3",children:"관리"})]})}),(0,a.jsx)("tbody",{children:P.map(e=>(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"py-2 px-3",children:e.email}),(0,a.jsx)("td",{className:"py-2 px-3",children:e.name}),(0,a.jsx)("td",{className:"py-2 px-3",children:(0,a.jsxs)("select",{value:e.role,onChange:t=>{e.isUser&&void 0!==e.id&&O(e.id,t.target.value)},className:"border rounded px-2 py-1",disabled:!e.isUser,children:[(0,a.jsx)("option",{value:"CUSTOMER",children:"고객"}),(0,a.jsx)("option",{value:"AGENT",children:"상담원"}),(0,a.jsx)("option",{value:"ADMIN",children:"관리자"})]})}),(0,a.jsx)("td",{className:"py-2 px-3",children:e.createdAt.slice(0,10)}),(0,a.jsx)("td",{className:"py-2 px-3",children:"등록완료"===e.status?(0,a.jsx)("span",{className:"text-green-600",children:"등록완료"}):(0,a.jsx)("span",{className:"text-blue-600",children:"초대메일 발송완료"})}),(0,a.jsx)("td",{className:"py-2 px-3",children:e.isUser&&void 0!==e.id?(0,a.jsx)("button",{onClick:()=>R(e.id),className:"text-red-600 hover:underline",children:"삭제"}):e.isUser||void 0===e.id?null:(0,a.jsx)("button",{onClick:()=>D(e.id),className:"text-red-600 hover:underline",children:"초대 삭제"})})]},e.email))})]})]})})}},4231:function(e,t,s){"use strict";s.d(t,{a:function(){return l}});var a=s(4529),r=s(9090);let l=(0,a.Ue)((e,t)=>({token:localStorage.getItem("token"),user:null,setToken:s=>{localStorage.setItem("token",s),e({token:s}),t().fetchUser()},setUser:t=>e({user:t}),fetchUser:async()=>{let s=t().token;if(!s)return e({user:null});try{let t=await r.Z.get("/users/me",{headers:{Authorization:"Bearer ".concat(s)}});e({user:t.data})}catch(t){e({user:null})}},logout:()=>{localStorage.removeItem("token"),e({token:null,user:null})}}))},9090:function(e,t,s){"use strict";var a=s(7066),r=s(3454);let l=a.Z.create({baseURL:r.env.NEXT_PUBLIC_API_URL||"http://localhost:4000"});t.Z=l}},function(e){e.O(0,[66,927,888,774,179],function(){return e(e.s=577)}),_N_E=e.O()}]);