(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[587],{9858:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mypage",function(){return n(904)}])},4820:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var s=n(5893),r=n(7294),a=n(1664),l=n.n(a),i=n(1163),o=n(4231);function c(e){let{children:t}=e,n=(0,i.useRouter)(),{token:a,logout:c,user:d,fetchUser:u}=(0,o.a)();return r.useEffect(()=>{a&&!d&&u()},[a,d,u]),(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,s.jsxs)("nav",{className:"sticky top-0 z-20 bg-white/90 backdrop-blur shadow-md px-8 py-4 flex items-center justify-between border-b",children:[(0,s.jsx)(l(),{href:"/",children:(0,s.jsx)("span",{className:"font-extrabold text-2xl text-blue-700 tracking-tight cursor-pointer select-none",children:"Ticket System"})}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l(),{href:"/tickets",children:(0,s.jsx)("span",{className:"hover:underline cursor-pointer text-blue-700 font-semibold px-3 py-1 rounded transition",children:"티켓 목록"})}),(0,s.jsx)(l(),{href:"/mypage",children:(0,s.jsx)("span",{className:"hover:underline cursor-pointer text-gray-700 font-semibold px-3 py-1 rounded transition",children:"내 정보"})}),(null==d?void 0:d.role)==="ADMIN"&&(0,s.jsx)(l(),{href:"/admin",children:(0,s.jsx)("span",{className:"hover:underline cursor-pointer text-red-700 font-semibold px-3 py-1 rounded transition",children:"관리자"})}),(0,s.jsx)("button",{onClick:()=>{c(),n.push("/login")},className:"bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 text-gray-700 font-semibold border border-gray-200 transition",children:"로그아웃"})]}):(0,s.jsx)(l(),{href:"/login",children:(0,s.jsx)("span",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 cursor-pointer font-semibold transition",children:"로그인"})})})]}),(0,s.jsx)("main",{className:"max-w-3xl mx-auto py-12 px-4 md:px-0",children:t})]})}},904:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var s=n(5893),r=n(7294),a=n(4820),l=n(9090),i=n(4231);function o(){let{token:e}=(0,i.a)(),[t,n]=(0,r.useState)(!0),[o,c]=(0,r.useState)(""),[d,u]=(0,r.useState)([]),[h,x]=(0,r.useState)(!0),[m,p]=(0,r.useState)(!1),[b,f]=(0,r.useState)(""),[g,v]=(0,r.useState)("");(0,r.useEffect)(()=>{e&&l.Z.get("/users/me/settings",{headers:{Authorization:"Bearer ".concat(e)}}).then(e=>{var t;n(null===(t=e.data.emailNotificationsEnabled)||void 0===t||t),u(e.data.extraEmails||[]),x(!1)}).catch(()=>x(!1))},[e]);let y=()=>{let e=o.trim();e&&!d.includes(e)&&(u([...d,e]),c(""))},N=e=>{u(d.filter(t=>t!==e))},j=async()=>{p(!0),f(""),v("");try{await l.Z.put("/users/me/settings",{emailNotificationsEnabled:t,extraEmails:d},{headers:{Authorization:"Bearer ".concat(e)}}),v("저장되었습니다.")}catch(e){var n,s;f((null===(s=e.response)||void 0===s?void 0:null===(n=s.data)||void 0===n?void 0:n.message)||"저장 실패")}finally{p(!1)}};return h?(0,s.jsx)(a.Z,{children:(0,s.jsx)("div",{className:"text-center py-12",children:"로딩 중..."})}):(0,s.jsx)(a.Z,{children:(0,s.jsxs)("div",{className:"max-w-lg mx-auto bg-white rounded shadow p-8 mt-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"내 환경설정"}),(0,s.jsxs)("div",{className:"mb-6 flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"emailNotificationsEnabled",checked:t,onChange:e=>n(e.target.checked),className:"w-5 h-5"}),(0,s.jsx)("label",{htmlFor:"emailNotificationsEnabled",className:"text-lg",children:"티켓/댓글/상태변경 알림 메일 받기"})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("div",{className:"mb-2 font-semibold",children:"추가 이메일"}),(0,s.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,s.jsx)("input",{type:"email",placeholder:"추가 이메일 입력",className:"flex-1 px-3 py-2 border rounded",value:o,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),y())}}),(0,s.jsx)("button",{type:"button",onClick:y,className:"bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700",children:"추가"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:d.map(e=>(0,s.jsxs)("span",{className:"bg-gray-200 px-2 py-1 rounded text-sm flex items-center gap-1",children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>N(e),className:"ml-1 text-red-500 hover:underline",children:"\xd7"})]},e))})]}),b&&(0,s.jsx)("div",{className:"text-red-500 mb-2",children:b}),g&&(0,s.jsx)("div",{className:"text-green-600 mb-2",children:g}),(0,s.jsx)("button",{type:"button",className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:opacity-50 font-semibold",onClick:j,disabled:m,children:m?"저장 중...":"저장"})]})})}},4231:function(e,t,n){"use strict";n.d(t,{a:function(){return a}});var s=n(4529),r=n(9090);let a=(0,s.Ue)((e,t)=>({token:localStorage.getItem("token"),user:null,setToken:n=>{localStorage.setItem("token",n),e({token:n}),t().fetchUser()},setUser:t=>e({user:t}),fetchUser:async()=>{let n=t().token;if(!n)return e({user:null});try{let t=await r.Z.get("/users/me",{headers:{Authorization:"Bearer ".concat(n)}});e({user:t.data})}catch(t){e({user:null})}},logout:()=>{localStorage.removeItem("token"),e({token:null,user:null})}}))},9090:function(e,t,n){"use strict";var s=n(7066),r=n(3454);let a=s.Z.create({baseURL:r.env.NEXT_PUBLIC_API_URL||"http://localhost:4000"});t.Z=a}},function(e){e.O(0,[66,927,888,774,179],function(){return e(e.s=9858)}),_N_E=e.O()}]);